import { Component, EventEmitter, HostListener, Inject, Input, Output, ViewChild, ViewContainerRef, } from '@angular/core';
import { Subject } from 'rxjs';
import { TOAST_CONFIG } from '../../../toast.tokens';
import { ToastPosition } from '../../../enums/enums';
import { darkenHexColor } from '../../../utils/utils';
import { NgClass, NgIf, NgStyle } from '@angular/common';
import * as i0 from "@angular/core";
export class ToastComponent {
    config;
    onClick(event) {
        event.stopPropagation();
    }
    container;
    toast;
    currentTheme;
    control = new EventEmitter();
    destroy$ = new Subject();
    isVisible = false;
    duration;
    remainingTime;
    timeout;
    resumeTime;
    component;
    svgUrlIsFromSprite = false;
    position = ToastPosition.BOTTOM_RIGHT;
    bottomRight = ToastPosition.BOTTOM_RIGHT;
    bottomLeft = ToastPosition.BOTTOM_LEFT;
    topRight = ToastPosition.TOP_RIGHT;
    topLeft = ToastPosition.TOP_LEFT;
    linearGradient = '';
    toastConfig;
    timebarColor;
    textColor = '';
    style = '';
    constructor(config) {
        this.config = config;
        this.toastConfig = this.config;
        if (this.toastConfig.position) {
            this.position = this.toastConfig.position;
        }
    }
    ngAfterViewInit() {
        if (this.toast.component) {
            this.createDynamicToast();
        }
    }
    ngOnInit() {
        this.getColors();
        this.svgUrlIsFromSprite = this.toast.icon?.includes('.svg#');
        if (this.toast?.infinite)
            return;
        this.duration = Number(this.toast.duration);
        this.remainingTime = Number(this.toast.duration);
        this.resumeTime = new Date();
        this.timeout = setTimeout(() => {
            this.destroyToast();
        }, this.duration);
    }
    ngAfterContentInit() {
        setTimeout(() => {
            this.isVisible = true;
        }, 10);
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    createDynamicToast() {
        this.container.clear();
        setTimeout(() => {
            this.component = this.container.createComponent(this.toast.component);
            this.component.instance.content = this.toast.content;
            if (this.toast?.context) {
                this.component.instance.context = this.toast.context;
            }
        }, 0);
    }
    destroyToast() {
        this.isVisible = false;
        setTimeout(() => {
            this.toast.isVisible = false;
            this.control.emit(this.toast);
        }, 100);
    }
    onMouseEnter() {
        if (this.toast?.infinite)
            return;
        clearTimeout(this.timeout);
        const diff = new Date().getTime() - this.resumeTime.getTime();
        this.remainingTime -= diff;
    }
    onMouseLeave() {
        if (this.toast?.infinite)
            return;
        this.resumeTime = new Date();
        this.timeout = setTimeout(() => {
            this.destroyToast();
        }, this.remainingTime);
    }
    getColors() {
        this.getToastStyle();
        this.getTimebarColor();
    }
    getToastStyle() {
        this.textColor = this.getToastTextColor();
        this.style = `--text-color: ${this.textColor};`;
        const colorHexCode = this.toastConfig?.colors?.[this.toast.type];
        if (!colorHexCode)
            return;
        const darkenedColorHexCode = darkenHexColor(colorHexCode, 0.725);
        this.linearGradient = this.config.colors?.autoGradient
            ? `linear-gradient(45deg, ${darkenedColorHexCode}, ${colorHexCode})`
            : colorHexCode;
        this.style += `background: ${this.linearGradient}`;
    }
    getToastTextColor() {
        const toastTypeText = this.toast.type + 'Text';
        const textColorHexCode = this.config.colors?.[toastTypeText] || '#ffffff';
        return textColorHexCode;
    }
    getTimebarColor() {
        if (!this.toastConfig.colors?.timebar)
            return;
        this.timebarColor = {
            background: this.toastConfig.colors?.timebar,
        };
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: ToastComponent, deps: [{ token: TOAST_CONFIG }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.8", type: ToastComponent, isStandalone: true, selector: "toast", inputs: { toast: "toast", currentTheme: "currentTheme" }, outputs: { control: "control" }, host: { listeners: { "click": "onClick($event)" } }, viewQueries: [{ propertyName: "container", first: true, predicate: ["container"], descendants: true, read: ViewContainerRef }], ngImport: i0, template: "<div (click)=\"toast.component ? null : destroyToast()\" [class.visible]=\"isVisible\" class=\"toast-container\" [class]=\"toast.type\" [class.dynamic]=\"toast.component ? true : false\" [ngClass]=\"{\n  'right': position === bottomRight || position === topRight,\n  'left': position === bottomLeft || position === topLeft\n}\" (mouseenter)=\"onMouseEnter()\" (mouseleave)=\"onMouseLeave()\" [id]=\"toast._id\" [style]=\"style\">\n  @if (toast.component) {\n    <div class=\"close\">\n      <button class=\"icon\" (click)=\"destroyToast()\"></button>\n    </div>\n  }\n  @if (!toast.infinite) {\n    <div class=\"toast-timer\" [style]=\"'--animation-speed: ' + duration/1000 + 's;'\" [ngStyle]=\"timebarColor\"></div>\n  }\n  <div class=\"toast-group\">\n    <div class=\"toast-group__top\" [ngClass]=\"toast.icon ? 'has-icon' : ''\">\n      @if (toast.icon) {\n        <div class=\"toast-group__icon\">\n          @if (svgUrlIsFromSprite) {\n            <svg>\n              <use [attr.xlink:href]=\"toast.icon\"></use>\n            </svg>\n          } @else {\n            <img [src]=\"toast.icon\">\n          }\n        </div>\n      }\n      <p class=\"toast-title\">{{ toast.title }}</p>\n    </div>\n    <div class=\"toast-group__bottom\">\n      @if (toast.component) {\n        <ng-template #container></ng-template>\n      } @else {\n        <p class=\"toast-content\">{{ toast.content }}</p>\n      }\n    </div>\n  </div>\n</div>", styles: [".toast-container{opacity:0;width:22.5rem;transition:all .3s;border-radius:8px;overflow:hidden;padding:1rem .8rem .8rem 1rem;position:relative}@media screen and (max-width: 768px){.toast-container{width:100%}}.toast-container .close{position:absolute;top:.5rem;right:.5rem;display:flex;justify-content:center;align-items:center}.toast-container .close .icon{width:25px;height:25px;position:relative;display:flex;justify-content:center;align-items:center;border:0;outline:0;background:transparent;transition:all .3s;cursor:pointer}.toast-container .close .icon:hover{opacity:.5}.toast-container .close .icon:before,.toast-container .close .icon:after{content:\"\";position:absolute;width:15px;height:2px;background-color:var(--text-color);transform-origin:center}.toast-container .close .icon:before{transform:rotate(45deg)}.toast-container .close .icon:after{transform:rotate(-45deg)}.toast-container .toast-group{display:flex;flex-direction:column;gap:.5rem}.toast-container .toast-group .toast-group__top{display:flex;align-items:center;gap:.5rem}.toast-container .toast-group .toast-group__top .toast-group__icon{display:flex;justify-content:flex-start;align-items:flex-start}.toast-container .toast-group .toast-group__top p.toast-title{font-size:var(--title-font-size);font-weight:700;text-transform:uppercase;color:var(--text-color);line-height:1.2rem}.toast-container .toast-group .toast-group__bottom p.toast-content{font-size:var(--content-font-size);font-weight:500;color:var(--text-color)}.toast-container .toast-timer{height:4px;position:absolute;top:0;left:0;border-radius:8px;animation:widthAnimation var(--animation-speed) linear;background:linear-gradient(45deg,#2b6bbf,#10425b);animation-iteration-count:1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.toast-container:not(.dynamic){cursor:pointer}.toast-container.right{transform:translate(120%)}.toast-container.left{transform:translate(-120%)}.toast-container.visible{transform:translate(0);opacity:1}.toast-container.visible:hover{opacity:.9}.toast-container.visible:hover .toast-timer{animation-play-state:paused}@keyframes widthAnimation{0%{width:0%}to{width:100%}}.toast-container.danger{background:linear-gradient(45deg,#d10303,#f77676)}.toast-container.success{background:linear-gradient(45deg,#00bd6e,#58d77c)}.toast-container.info{background:linear-gradient(45deg,#5b9dcb,#9cd1f7)}.toast-container.warning{background:linear-gradient(45deg,#f58802,#ffc600)}.toast-container svg{color:var(--text-color);fill:var(--text-color);width:30px;height:30px}.toast-container img{width:30px}\n", "*,*:after,*:before{font-family:var(--font-family);box-sizing:border-box;padding:0;margin:0}\n"], dependencies: [{ kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: ToastComponent, decorators: [{
            type: Component,
            args: [{ selector: 'toast', standalone: true, imports: [NgClass, NgIf, NgStyle], template: "<div (click)=\"toast.component ? null : destroyToast()\" [class.visible]=\"isVisible\" class=\"toast-container\" [class]=\"toast.type\" [class.dynamic]=\"toast.component ? true : false\" [ngClass]=\"{\n  'right': position === bottomRight || position === topRight,\n  'left': position === bottomLeft || position === topLeft\n}\" (mouseenter)=\"onMouseEnter()\" (mouseleave)=\"onMouseLeave()\" [id]=\"toast._id\" [style]=\"style\">\n  @if (toast.component) {\n    <div class=\"close\">\n      <button class=\"icon\" (click)=\"destroyToast()\"></button>\n    </div>\n  }\n  @if (!toast.infinite) {\n    <div class=\"toast-timer\" [style]=\"'--animation-speed: ' + duration/1000 + 's;'\" [ngStyle]=\"timebarColor\"></div>\n  }\n  <div class=\"toast-group\">\n    <div class=\"toast-group__top\" [ngClass]=\"toast.icon ? 'has-icon' : ''\">\n      @if (toast.icon) {\n        <div class=\"toast-group__icon\">\n          @if (svgUrlIsFromSprite) {\n            <svg>\n              <use [attr.xlink:href]=\"toast.icon\"></use>\n            </svg>\n          } @else {\n            <img [src]=\"toast.icon\">\n          }\n        </div>\n      }\n      <p class=\"toast-title\">{{ toast.title }}</p>\n    </div>\n    <div class=\"toast-group__bottom\">\n      @if (toast.component) {\n        <ng-template #container></ng-template>\n      } @else {\n        <p class=\"toast-content\">{{ toast.content }}</p>\n      }\n    </div>\n  </div>\n</div>", styles: [".toast-container{opacity:0;width:22.5rem;transition:all .3s;border-radius:8px;overflow:hidden;padding:1rem .8rem .8rem 1rem;position:relative}@media screen and (max-width: 768px){.toast-container{width:100%}}.toast-container .close{position:absolute;top:.5rem;right:.5rem;display:flex;justify-content:center;align-items:center}.toast-container .close .icon{width:25px;height:25px;position:relative;display:flex;justify-content:center;align-items:center;border:0;outline:0;background:transparent;transition:all .3s;cursor:pointer}.toast-container .close .icon:hover{opacity:.5}.toast-container .close .icon:before,.toast-container .close .icon:after{content:\"\";position:absolute;width:15px;height:2px;background-color:var(--text-color);transform-origin:center}.toast-container .close .icon:before{transform:rotate(45deg)}.toast-container .close .icon:after{transform:rotate(-45deg)}.toast-container .toast-group{display:flex;flex-direction:column;gap:.5rem}.toast-container .toast-group .toast-group__top{display:flex;align-items:center;gap:.5rem}.toast-container .toast-group .toast-group__top .toast-group__icon{display:flex;justify-content:flex-start;align-items:flex-start}.toast-container .toast-group .toast-group__top p.toast-title{font-size:var(--title-font-size);font-weight:700;text-transform:uppercase;color:var(--text-color);line-height:1.2rem}.toast-container .toast-group .toast-group__bottom p.toast-content{font-size:var(--content-font-size);font-weight:500;color:var(--text-color)}.toast-container .toast-timer{height:4px;position:absolute;top:0;left:0;border-radius:8px;animation:widthAnimation var(--animation-speed) linear;background:linear-gradient(45deg,#2b6bbf,#10425b);animation-iteration-count:1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.toast-container:not(.dynamic){cursor:pointer}.toast-container.right{transform:translate(120%)}.toast-container.left{transform:translate(-120%)}.toast-container.visible{transform:translate(0);opacity:1}.toast-container.visible:hover{opacity:.9}.toast-container.visible:hover .toast-timer{animation-play-state:paused}@keyframes widthAnimation{0%{width:0%}to{width:100%}}.toast-container.danger{background:linear-gradient(45deg,#d10303,#f77676)}.toast-container.success{background:linear-gradient(45deg,#00bd6e,#58d77c)}.toast-container.info{background:linear-gradient(45deg,#5b9dcb,#9cd1f7)}.toast-container.warning{background:linear-gradient(45deg,#f58802,#ffc600)}.toast-container svg{color:var(--text-color);fill:var(--text-color);width:30px;height:30px}.toast-container img{width:30px}\n", "*,*:after,*:before{font-family:var(--font-family);box-sizing:border-box;padding:0;margin:0}\n"] }]
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [TOAST_CONFIG]
                }] }], propDecorators: { onClick: [{
                type: HostListener,
                args: ['click', ['$event']]
            }], container: [{
                type: ViewChild,
                args: ['container', { read: ViewContainerRef }]
            }], toast: [{
                type: Input
            }], currentTheme: [{
                type: Input
            }], control: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWZyZW5jaC10b2FzdC9zcmMvbGliL2NvbXBvbmVudHMvdG9hc3RzL3RvYXN0L3RvYXN0LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1mcmVuY2gtdG9hc3Qvc3JjL2xpYi9jb21wb25lbnRzL3RvYXN0cy90b2FzdC90b2FzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsU0FBUyxFQUVULFlBQVksRUFDWixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBQ04sU0FBUyxFQUNULGdCQUFnQixHQUNqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFhLE1BQU0sTUFBTSxDQUFDO0FBRzFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDOztBQVN6RCxNQUFNLE9BQU8sY0FBYztJQStCaUI7SUEzQm5DLE9BQU8sQ0FBQyxLQUFVO1FBQ3ZCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRUQsU0FBUyxDQUFvQjtJQUNwQixLQUFLLENBQWM7SUFDbkIsWUFBWSxDQUFVO0lBQ3JCLE9BQU8sR0FBNkIsSUFBSSxZQUFZLEVBQWMsQ0FBQztJQUNyRSxRQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztJQUN2QyxTQUFTLEdBQVksS0FBSyxDQUFDO0lBQzNCLFFBQVEsQ0FBVTtJQUNs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QU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDOzswQkFpQ3BCLE1BQU07MkJBQUMsWUFBWTt5Q0EzQnpCLE9BQU87c0JBRGIsWUFBWTt1QkFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBS2pDLFNBQVM7c0JBRFIsU0FBUzt1QkFBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBRXpDLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNJLE9BQU87c0JBQWhCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0LCB0YWtlVW50aWwgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRvYXN0TW9kZWwgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVG9hc3RDb25maWcgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVE9BU1RfQ09ORklHIH0gZnJvbSAnLi4vLi4vLi4vdG9hc3QudG9rZW5zJztcbmltcG9ydCB7IFRvYXN0UG9zaXRpb24gfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9lbnVtcyc7XG5pbXBvcnQgeyBkYXJrZW5IZXhDb2xvciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IE5nQ2xhc3MsIE5nSWYsIE5nU3R5bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0b2FzdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90b2FzdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RvYXN0LmNvbXBvbmVudC5zY3NzJywgJy4uLy4uLy4uL3N0eWxlcy9jb21tb24tc3R5bGVzLnNjc3MnXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW05nQ2xhc3MsIE5nSWYsIE5nU3R5bGVdLFxufSlcbmV4cG9ydCBjbGFzcyBUb2FzdENvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95XG57XG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSlcbiAgcHVibGljIG9uQ2xpY2soZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxuICBjb250YWluZXIhOiBWaWV3Q29udGFpbmVyUmVmO1xuICBASW5wdXQoKSB0b2FzdCE6IFRvYXN0TW9kZWw7XG4gIEBJbnB1dCgpIGN1cnJlbnRUaGVtZSE6IHN0cmluZztcbiAgQE91dHB1dCgpIGNvbnRyb2w6IEV2ZW50RW1pdHRlcjxUb2FzdE1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8VG9hc3RNb2RlbD4oKTtcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIGlzVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBkdXJhdGlvbiE6IG51bWJlcjtcbiAgcmVtYWluaW5nVGltZSE6IG51bWJlcjtcbiAgdGltZW91dCE6IGFueTtcbiAgcmVzdW1lVGltZSE6IERhdGU7XG4gIGNvbXBvbmVudCE6IENvbXBvbmVudFJlZjxhbnk+O1xuICBzdmdVcmxJc0Zyb21TcHJpdGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9SSUdIVDtcbiAgYm90dG9tUmlnaHQ6IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9SSUdIVDtcbiAgYm90dG9tTGVmdDogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQ7XG4gIHRvcFJpZ2h0OiBUb2FzdFBvc2l0aW9uID0gVG9hc3RQb3NpdGlvbi5UT1BfUklHSFQ7XG4gIHRvcExlZnQ6IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLlRPUF9MRUZUO1xuICBsaW5lYXJHcmFkaWVudDogc3RyaW5nID0gJyc7XG4gIHRvYXN0Q29uZmlnITogVG9hc3RDb25maWc7XG4gIHRpbWViYXJDb2xvciE6IHsgYmFja2dyb3VuZDogc3RyaW5nIH07XG4gIHRleHRDb2xvcjogc3RyaW5nID0gJyc7XG4gIHN0eWxlOiBzdHJpbmcgPSAnJztcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFRPQVNUX0NPTkZJRykgcHJpdmF0ZSBjb25maWc6IFRvYXN0Q29uZmlnKSB7XG4gICAgdGhpcy50b2FzdENvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgIGlmICh0aGlzLnRvYXN0Q29uZmlnLnBvc2l0aW9uKSB7XG4gICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy50b2FzdENvbmZpZy5wb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudG9hc3QuY29tcG9uZW50KSB7XG4gICAgICB0aGlzLmNyZWF0ZUR5bmFtaWNUb2FzdCgpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZ2V0Q29sb3JzKCk7XG4gICAgdGhpcy5zdmdVcmxJc0Zyb21TcHJpdGUgPSB0aGlzLnRvYXN0Lmljb24/LmluY2x1ZGVzKCcuc3ZnIycpIGFzIGJvb2xlYW47XG4gICAgaWYgKHRoaXMudG9hc3Q/LmluZmluaXRlKSByZXR1cm47XG4gICAgdGhpcy5kdXJhdGlvbiA9IE51bWJlcih0aGlzLnRvYXN0LmR1cmF0aW9uKTtcbiAgICB0aGlzLnJlbWFpbmluZ1RpbWUgPSBOdW1iZXIodGhpcy50b2FzdC5kdXJhdGlvbik7XG4gICAgdGhpcy5yZXN1bWVUaW1lID0gbmV3IERhdGUoKTtcbiAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZGVzdHJveVRvYXN0KCk7XG4gICAgfSwgdGhpcy5kdXJhdGlvbik7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmlzVmlzaWJsZSA9IHRydWU7XG4gICAgfSwgMTApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgY3JlYXRlRHluYW1pY1RvYXN0KCk6IHZvaWQge1xuICAgIHRoaXMuY29udGFpbmVyLmNsZWFyKCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNvbXBvbmVudCA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudCh0aGlzLnRvYXN0LmNvbXBvbmVudCk7XG4gICAgICB0aGlzLmNvbXBvbmVudC5pbnN0YW5jZS5jb250ZW50ID0gdGhpcy50b2FzdC5jb250ZW50O1xuICAgICAgaWYgKHRoaXMudG9hc3Q/LmNvbnRleHQpIHtcbiAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFuY2UuY29udGV4dCA9IHRoaXMudG9hc3QuY29udGV4dDtcbiAgICAgIH1cbiAgICB9LCAwKTtcbiAgfVxuXG4gIGRlc3Ryb3lUb2FzdCgpIHtcbiAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy50b2FzdC5pc1Zpc2libGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuY29udHJvbC5lbWl0KHRoaXMudG9hc3QpO1xuICAgIH0sIDEwMCk7XG4gIH1cblxuICBvbk1vdXNlRW50ZXIoKSB7XG4gICAgaWYgKHRoaXMudG9hc3Q/LmluZmluaXRlKSByZXR1cm47XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgY29uc3QgZGlmZiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5yZXN1bWVUaW1lLmdldFRpbWUoKTtcbiAgICB0aGlzLnJlbWFpbmluZ1RpbWUgLT0gZGlmZjtcbiAgfVxuXG4gIG9uTW91c2VMZWF2ZSgpIHtcbiAgICBpZiAodGhpcy50b2FzdD8uaW5maW5pdGUpIHJldHVybjtcbiAgICB0aGlzLnJlc3VtZVRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5kZXN0cm95VG9hc3QoKTtcbiAgICB9LCB0aGlzLnJlbWFpbmluZ1RpbWUpO1xuICB9XG5cbiAgZ2V0Q29sb3JzKCk6IHZvaWQge1xuICAgIHRoaXMuZ2V0VG9hc3RTdHlsZSgpO1xuICAgIHRoaXMuZ2V0VGltZWJhckNvbG9yKCk7XG4gIH1cblxuICBnZXRUb2FzdFN0eWxlKCk6IHZvaWQge1xuICAgIHRoaXMudGV4dENvbG9yID0gdGhpcy5nZXRUb2FzdFRleHRDb2xvcigpO1xuICAgIHRoaXMuc3R5bGUgPSBgLS10ZXh0LWNvbG9yOiAke3RoaXMudGV4dENvbG9yfTtgO1xuICAgIGNvbnN0IGNvbG9ySGV4Q29kZTogc3RyaW5nID0gdGhpcy50b2FzdENvbmZpZz8uY29sb3JzPy5bXG4gICAgICB0aGlzLnRvYXN0LnR5cGVcbiAgICBdIGFzIHN0cmluZztcbiAgICBpZiAoIWNvbG9ySGV4Q29kZSkgcmV0dXJuO1xuICAgIGNvbnN0IGRhcmtlbmVkQ29sb3JIZXhDb2RlID0gZGFya2VuSGV4Q29sb3IoY29sb3JIZXhDb2RlIGFzIHN0cmluZywgMC43MjUpO1xuICAgIHRoaXMubGluZWFyR3JhZGllbnQgPSB0aGlzLmNvbmZpZy5jb2xvcnM/LmF1dG9HcmFkaWVudFxuICAgICAgPyBgbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCAke2RhcmtlbmVkQ29sb3JIZXhDb2RlfSwgJHtjb2xvckhleENvZGV9KWBcbiAgICAgIDogY29sb3JIZXhDb2RlO1xuICAgIHRoaXMuc3R5bGUgKz0gYGJhY2tncm91bmQ6ICR7dGhpcy5saW5lYXJHcmFkaWVudH1gO1xuICB9XG5cbiAgZ2V0VG9hc3RUZXh0Q29sb3IoKTogc3RyaW5nIHtcbiAgICBjb25zdCB0b2FzdFR5cGVUZXh0ID0gdGhpcy50b2FzdC50eXBlICsgJ1RleHQnO1xuICAgIGNvbnN0IHRleHRDb2xvckhleENvZGUgPVxuICAgICAgdGhpcy5jb25maWcuY29sb3JzPy5bXG4gICAgICAgIHRvYXN0VHlwZVRleHQgYXNcbiAgICAgICAgICB8ICdzdWNjZXNzVGV4dCdcbiAgICAgICAgICB8ICdkYW5nZXJUZXh0J1xuICAgICAgICAgIHwgJ2luZm9UZXh0J1xuICAgICAgICAgIHwgJ3dhcm5pbmdUZXh0J1xuICAgICAgXSB8fCAnI2ZmZmZmZic7XG4gICAgcmV0dXJuIHRleHRDb2xvckhleENvZGU7XG4gIH1cblxuICBnZXRUaW1lYmFyQ29sb3IoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnRvYXN0Q29uZmlnLmNvbG9ycz8udGltZWJhcikgcmV0dXJuO1xuICAgIHRoaXMudGltZWJhckNvbG9yID0ge1xuICAgICAgYmFja2dyb3VuZDogdGhpcy50b2FzdENvbmZpZy5jb2xvcnM/LnRpbWViYXIgYXMgc3RyaW5nLFxuICAgIH07XG4gIH1cbn1cbiIsIjxkaXYgKGNsaWNrKT1cInRvYXN0LmNvbXBvbmVudCA/IG51bGwgOiBkZXN0cm95VG9hc3QoKVwiIFtjbGFzcy52aXNpYmxlXT1cImlzVmlzaWJsZVwiIGNsYXNzPVwidG9hc3QtY29udGFpbmVyXCIgW2NsYXNzXT1cInRvYXN0LnR5cGVcIiBbY2xhc3MuZHluYW1pY109XCJ0b2FzdC5jb21wb25lbnQgPyB0cnVlIDogZmFsc2VcIiBbbmdDbGFzc109XCJ7XG4gICdyaWdodCc6IHBvc2l0aW9uID09PSBib3R0b21SaWdodCB8fCBwb3NpdGlvbiA9PT0gdG9wUmlnaHQsXG4gICdsZWZ0JzogcG9zaXRpb24gPT09IGJvdHRvbUxlZnQgfHwgcG9zaXRpb24gPT09IHRvcExlZnRcbn1cIiAobW91c2VlbnRlcik9XCJvbk1vdXNlRW50ZXIoKVwiIChtb3VzZWxlYXZlKT1cIm9uTW91c2VMZWF2ZSgpXCIgW2lkXT1cInRvYXN0Ll9pZFwiIFtzdHlsZV09XCJzdHlsZVwiPlxuICBAaWYgKHRvYXN0LmNvbXBvbmVudCkge1xuICAgIDxkaXYgY2xhc3M9XCJjbG9zZVwiPlxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImljb25cIiAoY2xpY2spPVwiZGVzdHJveVRvYXN0KClcIj48L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgfVxuICBAaWYgKCF0b2FzdC5pbmZpbml0ZSkge1xuICAgIDxkaXYgY2xhc3M9XCJ0b2FzdC10aW1lclwiIFtzdHlsZV09XCInLS1hbmltYXRpb24tc3BlZWQ6ICcgKyBkdXJhdGlvbi8xMDAwICsgJ3M7J1wiIFtuZ1N0eWxlXT1cInRpbWViYXJDb2xvclwiPjwvZGl2PlxuICB9XG4gIDxkaXYgY2xhc3M9XCJ0b2FzdC1ncm91cFwiPlxuICAgIDxkaXYgY2xhc3M9XCJ0b2FzdC1ncm91cF9fdG9wXCIgW25nQ2xhc3NdPVwidG9hc3QuaWNvbiA/ICdoYXMtaWNvbicgOiAnJ1wiPlxuICAgICAgQGlmICh0b2FzdC5pY29uKSB7XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0b2FzdC1ncm91cF9faWNvblwiPlxuICAgICAgICAgIEBpZiAoc3ZnVXJsSXNGcm9tU3ByaXRlKSB7XG4gICAgICAgICAgICA8c3ZnPlxuICAgICAgICAgICAgICA8dXNlIFthdHRyLnhsaW5rOmhyZWZdPVwidG9hc3QuaWNvblwiPjwvdXNlPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgICA8aW1nIFtzcmNdPVwidG9hc3QuaWNvblwiPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICB9XG4gICAgICA8cCBjbGFzcz1cInRvYXN0LXRpdGxlXCI+e3sgdG9hc3QudGl0bGUgfX08L3A+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInRvYXN0LWdyb3VwX19ib3R0b21cIj5cbiAgICAgIEBpZiAodG9hc3QuY29tcG9uZW50KSB7XG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjY29udGFpbmVyPjwvbmctdGVtcGxhdGU+XG4gICAgICB9IEBlbHNlIHtcbiAgICAgICAgPHAgY2xhc3M9XCJ0b2FzdC1jb250ZW50XCI+e3sgdG9hc3QuY29udGVudCB9fTwvcD5cbiAgICAgIH1cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj4iXX0=
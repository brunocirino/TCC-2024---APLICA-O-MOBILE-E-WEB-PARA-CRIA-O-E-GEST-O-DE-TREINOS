import { Component, Inject, ViewChildren } from '@angular/core';
import { delay, filter, startWith, Subject, takeUntil } from 'rxjs';
import { ToastComponent } from './toast/toast.component';
import { TOAST_CONFIG } from '../../toast.tokens';
import { ToastPosition } from '../../enums/enums';
import { NgClass, NgFor, NgIf } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "../../french-toast.service";
export class ToastsComponent {
    toastService;
    config;
    toasts = [];
    toastsComponents;
    position = ToastPosition.BOTTOM_RIGHT;
    bottomRight = ToastPosition.BOTTOM_RIGHT;
    bottomLeft = ToastPosition.BOTTOM_LEFT;
    topRight = ToastPosition.TOP_RIGHT;
    topLeft = ToastPosition.TOP_LEFT;
    fontFamily = '';
    titleFontSize = '';
    contentFontSize = '';
    style = '';
    componentRef;
    destroy$ = new Subject();
    constructor(toastService, config) {
        this.toastService = toastService;
        this.config = config;
        if (this.config.position)
            this.position = this.config.position;
    }
    ngOnInit() {
        this.getToasts();
        this.style = this.getStyles();
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    ngAfterViewInit() {
        this.toastsComponents.changes
            .pipe(takeUntil(this.destroy$), startWith(''), delay(0))
            .subscribe({
            next: () => {
                const reachedLimit = this.toastsComponents.toArray().length > (this.config.limit || 3);
                if (reachedLimit) {
                    this.toastsComponents.toArray()[0].destroyToast();
                }
            },
        });
    }
    getStyles() {
        this.fontFamily = `--font-family: ${this.config.font?.family || 'sans-serif'}`;
        this.titleFontSize = `--title-font-size: ${this.config.font?.titleFontSize || '1.2rem'}`;
        this.contentFontSize = `--content-font-size: ${this.config.font?.contentFontSize || '1rem'}`;
        return `${this.fontFamily}; ${this.titleFontSize}; ${this.contentFontSize}`;
    }
    getToasts() {
        this.listenForToasts();
        this.listenForDestroyAllToasts();
        this.listenForDestroyToast();
    }
    listenForToasts() {
        this.toastService.toast
            .pipe(takeUntil(this.destroy$), filter((toast) => !!toast))
            .subscribe({
            next: (toast) => {
                const toastElement = toast;
                const pinnedToastOnScreen = this.toasts.some((tst) => tst?.pinned);
                if (pinnedToastOnScreen && !toast?.pinned) {
                    const firstPinnedToastIndex = this.toasts.indexOf(this.toasts.find((e) => e.pinned));
                    this.toasts.splice(firstPinnedToastIndex, 0, toastElement);
                    return;
                }
                this.toasts.push(toast);
            },
        });
    }
    listenForDestroyAllToasts() {
        this.toastService.clearAll
            .pipe(takeUntil(this.destroy$))
            .subscribe({
            next: () => {
                if (!this.toastsComponents)
                    return;
                this.toastsComponents.toArray().forEach((e) => {
                    e.destroyToast();
                });
            },
        });
    }
    listenForDestroyToast() {
        this.toastService.clearToast
            .pipe(takeUntil(this.destroy$))
            .subscribe({
            next: (uniqueId) => {
                this.toastsComponents.toArray().find(toast => toast.toast._uId === uniqueId)?.destroyToast();
            }
        });
    }
    control(toast) {
        const index = this.toasts.indexOf(toast);
        this.toasts.splice(index, 1);
        if (this.toasts.length === 0) {
            this.componentRef.destroy();
        }
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: ToastsComponent, deps: [{ token: i1.ToastService }, { token: TOAST_CONFIG }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.8", type: ToastsComponent, isStandalone: true, selector: "french-toast", viewQueries: [{ propertyName: "toastsComponents", predicate: ToastComponent, descendants: true }], ngImport: i0, template: "@if (toasts.length) {\n  <div class=\"toasts-container\" [style]=\"style\" [ngClass]=\"{\n    'bottom-right': position === bottomRight,\n    'bottom-left': position === bottomLeft,\n    'top-left': position === topLeft,\n    'top-right': position === topRight\n  }\">\n    @for (toast of toasts; track toast._id) {\n      @if (toast?.isVisible) {\n        <toast [toast]=\"toast\" (control)=\"control($event)\"/>\n      }\n    }\n</div>\n}", styles: [".toasts-container{position:fixed;display:flex;gap:.5rem;z-index:1050;padding:1rem}@media screen and (max-width: 768px){.toasts-container{width:100%}}.toasts-container.bottom-right{bottom:0rem;right:0rem;flex-direction:column}.toasts-container.bottom-left{bottom:0rem;left:0rem;flex-direction:column}.toasts-container.top-right{top:0rem;right:0rem;flex-direction:column-reverse}.toasts-container.top-left{top:0rem;left:0rem;flex-direction:column-reverse}\n", "*,*:after,*:before{font-family:var(--font-family);box-sizing:border-box;padding:0;margin:0}\n"], dependencies: [{ kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "component", type: ToastComponent, selector: "toast", inputs: ["toast", "currentTheme"], outputs: ["control"] }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.8", ngImport: i0, type: ToastsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'french-toast', standalone: true, imports: [
                        NgIf,
                        NgClass,
                        NgFor,
                        ToastComponent
                    ], template: "@if (toasts.length) {\n  <div class=\"toasts-container\" [style]=\"style\" [ngClass]=\"{\n    'bottom-right': position === bottomRight,\n    'bottom-left': position === bottomLeft,\n    'top-left': position === topLeft,\n    'top-right': position === topRight\n  }\">\n    @for (toast of toasts; track toast._id) {\n      @if (toast?.isVisible) {\n        <toast [toast]=\"toast\" (control)=\"control($event)\"/>\n      }\n    }\n</div>\n}", styles: [".toasts-container{position:fixed;display:flex;gap:.5rem;z-index:1050;padding:1rem}@media screen and (max-width: 768px){.toasts-container{width:100%}}.toasts-container.bottom-right{bottom:0rem;right:0rem;flex-direction:column}.toasts-container.bottom-left{bottom:0rem;left:0rem;flex-direction:column}.toasts-container.top-right{top:0rem;right:0rem;flex-direction:column-reverse}.toasts-container.top-left{top:0rem;left:0rem;flex-direction:column-reverse}\n", "*,*:after,*:before{font-family:var(--font-family);box-sizing:border-box;padding:0;margin:0}\n"] }]
        }], ctorParameters: () => [{ type: i1.ToastService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [TOAST_CONFIG]
                }] }], propDecorators: { toastsComponents: [{
                type: ViewChildren,
                args: [ToastComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3RzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1mcmVuY2gtdG9hc3Qvc3JjL2xpYi9jb21wb25lbnRzL3RvYXN0cy90b2FzdHMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWZyZW5jaC10b2FzdC9zcmMvbGliL2NvbXBvbmVudHMvdG9hc3RzL3RvYXN0cy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBRUwsU0FBUyxFQUVULE1BQU0sRUFJTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXpELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQWN2RCxNQUFNLE9BQU8sZUFBZTtJQWdCaEI7SUFDc0I7SUFoQmhDLE1BQU0sR0FBaUIsRUFBRSxDQUFDO0lBQ0ksZ0JBQWdCLENBQTZCO0lBQzNFLFFBQVEsR0FBa0IsYUFBYSxDQUFDLFlBQVksQ0FBQztJQUNyRCxXQUFXLEdBQWtCLGFBQWEsQ0FBQyxZQUFZLENBQUM7SUFDeEQsVUFBVSxHQUFrQixhQUFhLENBQUMsV0FBVyxDQUFDO0lBQ3RELFFBQVEsR0FBa0IsYUFBYSxDQUFDLFNBQVMsQ0FBQztJQUNsRCxPQUFPLEdBQWtCLGFBQWEsQ0FBQyxRQUFRLENBQUM7SUFDaEQsVUFBVSxHQUFXLEVBQUUs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QUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDO1lBQy9GLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsT0FBTyxDQUFDLEtBQWlCO1FBQ3ZCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3QixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzdCLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDOUIsQ0FBQztJQUNILENBQUM7dUdBakhVLGVBQWUsOENBaUJoQixZQUFZOzJGQWpCWCxlQUFlLDZHQUVaLGNBQWMsZ0RDbEM5Qix5YkFhQyxrbUJEY0csT0FBTyxvRkFFUCxjQUFjOzsyRkFHTCxlQUFlO2tCQVozQixTQUFTOytCQUNFLGNBQWMsY0FHWixJQUFJLFdBQ1A7d0JBQ1AsSUFBSTt3QkFDSixPQUFPO3dCQUNQLEtBQUs7d0JBQ0wsY0FBYztxQkFDZjs7MEJBbUJFLE1BQU07MkJBQUMsWUFBWTt5Q0FmUSxnQkFBZ0I7c0JBQTdDLFlBQVk7dUJBQUMsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRSZWYsXG4gIEluamVjdCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkcmVuXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZGVsYXksIGZpbHRlciwgc3RhcnRXaXRoLCBTdWJqZWN0LCB0YWtlVW50aWwgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRvYXN0TW9kZWwgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVG9hc3RDb21wb25lbnQgfSBmcm9tICcuL3RvYXN0L3RvYXN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUb2FzdFNlcnZpY2UgfSBmcm9tICcuLi8uLi9mcmVuY2gtdG9hc3Quc2VydmljZSc7XG5pbXBvcnQgeyBUT0FTVF9DT05GSUcgfSBmcm9tICcuLi8uLi90b2FzdC50b2tlbnMnO1xuaW1wb3J0IHsgVG9hc3RDb25maWcgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVG9hc3RQb3NpdGlvbiB9IGZyb20gJy4uLy4uL2VudW1zL2VudW1zJztcbmltcG9ydCB7IE5nQ2xhc3MsIE5nRm9yLCBOZ0lmIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZnJlbmNoLXRvYXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RvYXN0cy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RvYXN0cy5jb21wb25lbnQuc2NzcycsICcuLi8uLi9zdHlsZXMvY29tbW9uLXN0eWxlcy5zY3NzJ10sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBOZ0lmLFxuICAgIE5nQ2xhc3MsXG4gICAgTmdGb3IsXG4gICAgVG9hc3RDb21wb25lbnRcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBUb2FzdHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIHRvYXN0czogVG9hc3RNb2RlbFtdID0gW107XG4gIEBWaWV3Q2hpbGRyZW4oVG9hc3RDb21wb25lbnQpIHRvYXN0c0NvbXBvbmVudHMhOiBRdWVyeUxpc3Q8VG9hc3RDb21wb25lbnQ+O1xuICBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX1JJR0hUO1xuICBib3R0b21SaWdodDogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX1JJR0hUO1xuICBib3R0b21MZWZ0OiBUb2FzdFBvc2l0aW9uID0gVG9hc3RQb3NpdGlvbi5CT1RUT01fTEVGVDtcbiAgdG9wUmlnaHQ6IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLlRPUF9SSUdIVDtcbiAgdG9wTGVmdDogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uVE9QX0xFRlQ7XG4gIGZvbnRGYW1pbHk6IHN0cmluZyA9ICcnO1xuICB0aXRsZUZvbnRTaXplOiBzdHJpbmcgPSAnJztcbiAgY29udGVudEZvbnRTaXplOiBzdHJpbmcgPSAnJztcbiAgc3R5bGU6IHN0cmluZyA9ICcnO1xuICBjb21wb25lbnRSZWYhOiBDb21wb25lbnRSZWY8VG9hc3RzQ29tcG9uZW50PjtcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0b2FzdFNlcnZpY2U6IFRvYXN0U2VydmljZSxcbiAgICBASW5qZWN0KFRPQVNUX0NPTkZJRykgcHJpdmF0ZSBjb25maWc6IFRvYXN0Q29uZmlnXG4gICkge1xuICAgIGlmICh0aGlzLmNvbmZpZy5wb3NpdGlvbikgdGhpcy5wb3NpdGlvbiA9IHRoaXMuY29uZmlnLnBvc2l0aW9uO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5nZXRUb2FzdHMoKTtcbiAgICB0aGlzLnN0eWxlID0gdGhpcy5nZXRTdHlsZXMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0c0NvbXBvbmVudHMuY2hhbmdlc1xuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcbiAgICAgICAgc3RhcnRXaXRoKCcnKSxcbiAgICAgICAgZGVsYXkoMClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVhY2hlZExpbWl0ID0gdGhpcy50b2FzdHNDb21wb25lbnRzLnRvQXJyYXkoKS5sZW5ndGggPiAodGhpcy5jb25maWcubGltaXQgfHwgMyk7XG4gICAgICAgICAgaWYgKHJlYWNoZWRMaW1pdCkge1xuICAgICAgICAgICAgdGhpcy50b2FzdHNDb21wb25lbnRzLnRvQXJyYXkoKVswXS5kZXN0cm95VG9hc3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgfVxuXG4gIGdldFN0eWxlcygpOiBzdHJpbmcge1xuICAgIHRoaXMuZm9udEZhbWlseSA9IGAtLWZvbnQtZmFtaWx5OiAke3RoaXMuY29uZmlnLmZvbnQ/LmZhbWlseSB8fCAnc2Fucy1zZXJpZid9YDtcbiAgICB0aGlzLnRpdGxlRm9udFNpemUgPSBgLS10aXRsZS1mb250LXNpemU6ICR7dGhpcy5jb25maWcuZm9udD8udGl0bGVGb250U2l6ZSB8fCAnMS4ycmVtJ31gO1xuICAgIHRoaXMuY29udGVudEZvbnRTaXplID0gYC0tY29udGVudC1mb250LXNpemU6ICR7dGhpcy5jb25maWcuZm9udD8uY29udGVudEZvbnRTaXplIHx8ICcxcmVtJ31gO1xuICAgIHJldHVybiBgJHt0aGlzLmZvbnRGYW1pbHl9OyAke3RoaXMudGl0bGVGb250U2l6ZX07ICR7dGhpcy5jb250ZW50Rm9udFNpemV9YDtcbiAgfVxuXG4gIGdldFRvYXN0cygpOiB2b2lkIHtcbiAgICB0aGlzLmxpc3RlbkZvclRvYXN0cygpO1xuICAgIHRoaXMubGlzdGVuRm9yRGVzdHJveUFsbFRvYXN0cygpO1xuICAgIHRoaXMubGlzdGVuRm9yRGVzdHJveVRvYXN0KCk7XG4gIH1cblxuICBsaXN0ZW5Gb3JUb2FzdHMoKTogdm9pZCB7XG4gICAgdGhpcy50b2FzdFNlcnZpY2UudG9hc3RcbiAgICAucGlwZShcbiAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcbiAgICAgIGZpbHRlcigodG9hc3QpID0+ICEhdG9hc3QpXG4gICAgKVxuICAgIC5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKHRvYXN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHRvYXN0RWxlbWVudDogVG9hc3RNb2RlbCA9IHRvYXN0IGFzIFRvYXN0TW9kZWw7XG4gICAgICAgIGNvbnN0IHBpbm5lZFRvYXN0T25TY3JlZW4gPSB0aGlzLnRvYXN0cy5zb21lKCh0c3QpID0+IHRzdD8ucGlubmVkKTtcbiAgICAgICAgaWYgKHBpbm5lZFRvYXN0T25TY3JlZW4gJiYgIXRvYXN0Py5waW5uZWQpIHtcbiAgICAgICAgICBjb25zdCBmaXJzdFBpbm5lZFRvYXN0SW5kZXggPSB0aGlzLnRvYXN0cy5pbmRleE9mKFxuICAgICAgICAgICAgdGhpcy50b2FzdHMuZmluZCgoZSkgPT4gZS5waW5uZWQpIGFzIFRvYXN0TW9kZWxcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMudG9hc3RzLnNwbGljZShmaXJzdFBpbm5lZFRvYXN0SW5kZXgsIDAsIHRvYXN0RWxlbWVudCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9hc3RzLnB1c2godG9hc3QgYXMgVG9hc3RNb2RlbCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgbGlzdGVuRm9yRGVzdHJveUFsbFRvYXN0cygpOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0U2VydmljZS5jbGVhckFsbFxuICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAuc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnRvYXN0c0NvbXBvbmVudHMpIHJldHVybjtcbiAgICAgICAgdGhpcy50b2FzdHNDb21wb25lbnRzLnRvQXJyYXkoKS5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgZS5kZXN0cm95VG9hc3QoKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgbGlzdGVuRm9yRGVzdHJveVRvYXN0KCk6IHZvaWQge1xuICAgIHRoaXMudG9hc3RTZXJ2aWNlLmNsZWFyVG9hc3RcbiAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAodW5pcXVlSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLnRvYXN0c0NvbXBvbmVudHMudG9BcnJheSgpLmZpbmQodG9hc3QgPT4gdG9hc3QudG9hc3QuX3VJZCA9PT0gdW5pcXVlSWQpPy5kZXN0cm95VG9hc3QoKTtcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgY29udHJvbCh0b2FzdDogVG9hc3RNb2RlbCk6IHZvaWQge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy50b2FzdHMuaW5kZXhPZih0b2FzdCk7XG4gICAgdGhpcy50b2FzdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICBpZiAodGhpcy50b2FzdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgfVxuICB9XG59XG4iLCJAaWYgKHRvYXN0cy5sZW5ndGgpIHtcbiAgPGRpdiBjbGFzcz1cInRvYXN0cy1jb250YWluZXJcIiBbc3R5bGVdPVwic3R5bGVcIiBbbmdDbGFzc109XCJ7XG4gICAgJ2JvdHRvbS1yaWdodCc6IHBvc2l0aW9uID09PSBib3R0b21SaWdodCxcbiAgICAnYm90dG9tLWxlZnQnOiBwb3NpdGlvbiA9PT0gYm90dG9tTGVmdCxcbiAgICAndG9wLWxlZnQnOiBwb3NpdGlvbiA9PT0gdG9wTGVmdCxcbiAgICAndG9wLXJpZ2h0JzogcG9zaXRpb24gPT09IHRvcFJpZ2h0XG4gIH1cIj5cbiAgICBAZm9yICh0b2FzdCBvZiB0b2FzdHM7IHRyYWNrIHRvYXN0Ll9pZCkge1xuICAgICAgQGlmICh0b2FzdD8uaXNWaXNpYmxlKSB7XG4gICAgICAgIDx0b2FzdCBbdG9hc3RdPVwidG9hc3RcIiAoY29udHJvbCk9XCJjb250cm9sKCRldmVudClcIi8+XG4gICAgICB9XG4gICAgfVxuPC9kaXY+XG59Il19